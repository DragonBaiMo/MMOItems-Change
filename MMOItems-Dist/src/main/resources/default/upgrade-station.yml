# ========================================
#       强化工作台 GUI 配置（新版字符图）
# ========================================
#
# ===== 通用占位符支持 =====
# 所有 items.* 的 name 和 lore 字段都支持以下占位符：
#
# 【成功率相关】
#   {rate}           - 当前最终成功率%（已计算衰减和加成）
#   {color}          - 成功率对应颜色码（>=80%绿色，>=50%黄色等）
#   {base}           - 强化石基础成功率%
#   {decayed}        - 等级衰减后成功率%
#   {bonus}          - 幸运石加成百分比
#
# 【等级信息】
#   {level}          - 当前强化等级
#   {max_level}      - 最大强化等级
#   {next_level}     - 下一级（当前+1）
#   {template}       - 强化模板名称
#   {item_name}      - 物品显示名称
#
# 【保底系统】
#   {guarantee_current}   - 保底计数
#   {guarantee_max}       - 保底阈值
#   {guarantee_triggered} - 是否已触发保底（true/false）
#
# 【惩罚信息】
#   {break_chance}     - 碎裂概率%（已计算保护石减免）
#   {downgrade_chance} - 掉级概率%
#   {downgrade_amount} - 掉级数量
#   {destroys_on_fail} - 失败是否销毁（true/false）
#   {has_penalty}      - 是否有惩罚（true/false）
#
# 【辅助石效果】
#   {protection}     - 保护石减免%
#   {direct_chance}  - 直达石概率%
#   {direct_levels}  - 直达石跳跃等级数
#
# 【每日限制】
#   {daily_used}      - 今日已用次数
#   {daily_max}       - 今日最大次数
#   {daily_remaining} - 今日剩余次数
#
# 【经济消耗】
#   {cost}        - 格式化后的费用
#   {cost_raw}    - 原始费用数值
#   {balance}     - 格式化后的余额
#   {balance_raw} - 原始余额数值
#   {can_afford}  - 是否负担得起（true/false）
#
# 【玩家信息】
#   {player}      - 玩家名称
#
# ========================================

gui:
  title: "&5&l强化工作台 &8- &7放入物品开始强化"
  rows: 6
  fill-background: false   # 关闭自动铺底，完全由 layout-map 控制

# 布局：字符图 + 映射（TrMenu 风格）
# 字符图（每行 9 格，最多 6 行）
layout-map:
  - "#########"
  - "#T#P#C#B#"
  - "#L#A#S#I#"
  - "#.#R#.#.#"
  - "#.#D#.#.#"
  - "#GGGGGGG#"

# 映射：type=item|bind；ref=item 时指向 items.<ref>，bind 时为功能槽键
# 功能槽键：target-item, upgrade-stone, preview, lucky-stone, protect-stone, direct-stone, upgrade-button, info-panel, close-button, progress-bar
legend:
  "#": {type: item, ref: border}
  ".": {type: item, ref: filler}
  "T": {type: item, ref: title}
  "P": {type: bind, ref: preview, display: preview-waiting}
  "C": {type: bind, ref: close-button, display: close-button}
  "B": {type: bind, ref: upgrade-button, display: upgrade-button-enabled}
  "L": {type: bind, ref: lucky-stone}
  "A": {type: bind, ref: target-item}
  "S": {type: bind, ref: upgrade-stone}
  "I": {type: bind, ref: info-panel, display: info-panel}
  "R": {type: bind, ref: protect-stone}
  "D": {type: bind, ref: direct-stone}
  "G": {type: bind, ref: progress-bar}

# 物品显示（仅保留实际会用到的键）
# 额外字段：
# - custom-model-data: 1..N（可选）
# - hide: true 可隐藏该物品（等价于不显示）
items:
  title:
    material: ANVIL
    name: "&5&l✦ 强化工作台 ✦"
    lore:
      - "&7将装备/强化石放入对应槽位"
      - "&7查看成功率后点击强化"
      - "&e辅料石可提升强化效果"

  border:
    material: PURPLE_STAINED_GLASS_PANE
    name: " "

  filler:
    material: BLACK_STAINED_GLASS_PANE
    name: " "

  preview-waiting:
    material: ARROW
    name: "&f&l→ 强化 →"
    lore:
      - "&7放入物品后查看预览"

  preview-normal:
    material: NETHER_STAR
    name: "&e&l强化预览"

  preview-invalid:
    material: BARRIER
    name: "&c无效物品"
    lore:
      - "&7该物品不能强化"

  preview-max-level:
    material: STRUCTURE_VOID
    name: "&6&l已达最大等级"

  preview-need-stone:
    material: BARRIER
    name: "&c请放入强化石"
    lore:
      - "&7"
      - "&7放入匹配的强化石后"
      - "&7才能生成强化预览"

  preview-stone-mismatch:
    material: BARRIER
    name: "&c强化石不匹配"
    lore:
      - "&7"
      - "&c当前强化石无法用于此物品"
      - "&7请更换匹配的强化石"

  preview-not-upgradable:
    material: BARRIER
    name: "&c物品不可强化"
    lore:
      - "&7该物品没有强化属性"

  close-button:
    material: BARRIER
    name: "&c&l关闭"
    lore:
      - "&7点击关闭工作台"
      - "&7物品将返还背包"

  upgrade-button-enabled:
    material: LIME_CONCRETE
    name: "&a&l✦ 点击强化 ✦"
    lore:
      - "&a▶ 执行强化"
      - "&7当前成功率: {color}{rate}%"
      - "&7当前等级: &f+{level} &8→ &a+{next_level}"
      - "&e强化有风险，请谨慎"

  upgrade-button-disabled:
    material: RED_CONCRETE
    name: "&c&l✦ 无法强化 ✦"
    lore:
      - "&c请检查物品和强化石"

  upgrade-button-cooldown:
    material: GRAY_CONCRETE
    name: "&7&l请稍候..."
    lore:
      - "&7正在处理中"

  info-panel:
    material: BOOK
    name: "&e&l强化信息"

  progress-label:
    material: EXPERIENCE_BOTTLE
    name: "&f成功率"

# 进度条颜色配置
progress-bar:
  high:   {material: LIME_STAINED_GLASS_PANE,   color: "&a"}  # >=80%
  medium: {material: YELLOW_STAINED_GLASS_PANE, color: "&e"}  # >=50%
  low:    {material: ORANGE_STAINED_GLASS_PANE, color: "&6"}  # >=30%
  danger: {material: RED_STAINED_GLASS_PANE,    color: "&c"}  # <30%
  empty:  {material: WHITE_STAINED_GLASS_PANE,  color: "&8"}

# 消息配置
messages:
  success-rate: "&7成功率: {color}{rate}%"
  base-rate: "&7基础成功率: &f{rate}%"
  decayed-rate: "&7等级衰减后: &f{rate}%"
  lucky-bonus: "&a× 幸运石: &f×(1+{rate}%)"
  guarantee-progress: "&6保底进度: &f{current}/{max}"
  guarantee-triggered: "&6★ 已触发保底！必定成功 ★"
  daily-limit: "&e今日强化次数:"
  daily-used: "  &7已用: &f{used}/{max}"
  daily-remaining: "  &7剩余: {color}{remaining} 次"
  risk-title: "&c⚠ 失败风险:"
  risk-break: "  &c☠ 碎裂: {rate}%"
  risk-downgrade: "  &e↓ 掉级: {rate}% (-{amount}级)"
  risk-destroy: "  &c✖ 失败销毁物品"
  risk-none: "  &a✓ 当前等级无惩罚"
  protection-effect: "&b✦ 保护石效果:"
  protection-value: "  &b惩罚概率 -{rate}%"
  current-level: "&e当前等级: &f+{level}"
  after-level: "&a强化后: &f+{level}"
  max-level: "&7最大等级: &f+{level}"
  direct-effect: "&d✦ 直达石效果:"
  direct-chance: "&d  {chance}% 概率直接到 +{level}"
  item-name: "&f物品: {name}"
  preview-title: "&e⚡ 强化预览 ⚡"
  preview-original-item: "&f原物品: {name}"
  preview-full-stats: "&7&o强化后完整属性:"
  preview-separator: "&8─────────────────"
  preview-fallback: "&8(无法生成完整预览)"
  preview-max-reached: "&c已达到强化上限，无法继续强化"
  item-state-invalid: "&c物品状态异常，请重新放入物品"
  daily-limit-reached: "&c今日强化次数已用尽 ({used}/{max})"
  template-not-found: "&c未找到强化模板: &f{template}"
  upgrade-error: "&c强化失败: &f{reason}"
  upgrade-fail-default: "强化失败"
  upgrade-fail: "&c{reason}"
  upgrade-fail-protected: "&a强化失败，但保护已生效：&f{reason}"
  upgrade-fail-protected-break: "&a强化失败，保护已生效（拦截碎裂）：&f{reason}"
  upgrade-fail-protected-downgrade: "&a强化失败，保护已生效（拦截掉级）：&f{reason}"
  upgrade-fail-protected-destroy: "&a强化失败，保护已生效（拦截销毁）：&f{reason}"
  # 经济消耗
  economy-title: "&6✦ 强化费用:"
  economy-cost: "  &6消耗: &f{cost}"
  economy-balance: "  &7余额: {color}{balance}"
  # 全局加成
  global-bonus-title: "&d✦ 全局加成:"
  global-bonus-value: "  &d成功率 +{rate}%"
  # 阻断原因
  block-no-item: "&c• 请放入待强化物品"
  block-not-mmoitem: "&c• 物品不是 MMOItems 物品"
  block-not-upgradable: "&c• 物品不可强化"
  block-max-level: "&c• 已达最大等级"
  block-no-stone: "&c• 请放入强化石"
  block-stone-mismatch: "&c• 强化石不匹配"

# 属性变化标记
change-marker:
  enabled: true
  format: " &8({color}{sign}{value}&8)"
  positive-color: "&a"
  negative-color: "&c"
  decimal-places: 1
  min-change: 0.01

# 音效配置
sounds:
  item-place:       {sound: BLOCK_NOTE_BLOCK_PLING,   volume: 0.5, pitch: 1.2}
  upgrade-success:  {sound: ENTITY_PLAYER_LEVELUP,    volume: 1.0, pitch: 1.5}
  upgrade-fail:     {sound: ENTITY_ITEM_BREAK,        volume: 1.0, pitch: 1.0}
  guarantee-trigger: {sound: ENTITY_PLAYER_LEVELUP,    volume: 1.0, pitch: 2.0}
  direct-up:        {sound: ENTITY_PLAYER_LEVELUP,    volume: 1.0, pitch: 2.5}
  deny:             {sound: ENTITY_VILLAGER_NO,       volume: 1.0, pitch: 1.0}
  click:            {sound: UI_BUTTON_CLICK,          volume: 0.5, pitch: 1.0}
  close:            {sound: BLOCK_CHEST_CLOSE,        volume: 0.5, pitch: 1.0}

# 安全设置
security:
  upgrade-cooldown: 200
  return-items-on-close: true
  return-items-on-quit: true
  block-shift-click: true
  block-number-key: true
  block-drag: false
  # 调试开关：输出强化执行链路日志（用于排查间歇性等级异常）
  debug-upgrade-trace: false
